function initReviews(e){const t=document.getElementById("reviews-container"),n=document.getElementById("average-rating-stars"),a=document.getElementById("average-rating-value"),i=document.getElementById("total-reviews"),o=document.getElementById("prev-page"),r=document.getElementById("next-page"),s=document.getElementById("page-info");let d=1;const l=10,c=Math.ceil(e.length/l),m=e.reduce((e,t)=>e+t.rating,0)/e.length;function g(){t.innerHTML="";const n=(d-1)*l,a=n+l,i=e.slice(n,a);0!==i.length?(i.forEach(e=>{const n=function(e){const t=document.createElement("div");return t.className="review-card",t.innerHTML=`\n            <img src="${e.avatar}" alt="${e.name}" class="review-avatar" onerror="this.src='/images/default-avatar.jpg'">\n            <div class="review-content">\n                <div class="review-header">\n                    <span class="review-name">${e.name}</span>\n                </div>\n                <div class="review-rating">\n                    ${'<i class="fas fa-star filled"></i>'.repeat(e.rating)}\n                    ${'<i class="fas fa-star gray"></i>'.repeat(5-e.rating)}\n                </div>\n                <p class="review-comment">${e.comment}</p>\n            </div>\n        `,t}(e);t.appendChild(n)}),s.textContent=`Page ${d} of ${c}`,o.disabled=1===d,r.disabled=d===c):t.innerHTML='<p class="no-reviews">No reviews to display</p>'}a.textContent=m.toFixed(1),i.textContent=`(${e.length} reviews)`,function(e){n.innerHTML="";const t=Math.floor(e),a=e%1>=.5;for(let e=1;e<=5;e++){const i=document.createElement("i");i.className=e<=t?"fas fa-star filled":e===t+1&&a?"fas fa-star-half-alt filled":"fas fa-star gray",n.appendChild(i)}}(m),o.addEventListener("click",()=>{d>1&&(d--,g())}),r.addEventListener("click",()=>{d<c&&(d++,g())}),g()}function initDetailPage(){const e=new URLSearchParams(window.location.search).get("id");if(!e)return void(window.location.href="list.html");const t=gamesData.gameList.find(t=>t.folder===e);if(!t)return void(window.location.href="list.html");document.getElementById("game-title").textContent=t.title,document.getElementById("game-author").textContent=t.author||"Unknown",document.getElementById("game-rating").textContent=t.rating||"0",document.getElementById("game-popularity").textContent=t.popularity||"0",document.getElementById("game-description").textContent=t.description||"No description available.",document.getElementById("strategy-guide").innerHTML=t.strategy_guide||"No strategy guide available.";const n=document.getElementById("game-container"),a=document.getElementById("game-title"),i=document.getElementById("game-description");a.textContent=t.title,i.textContent=t.description||"Explore and enjoy the game!";const o=document.getElementById("play-game-button");n&&o.addEventListener("click",function(){n.innerHTML="";const e=document.createElement("iframe");e.src=t.index,e.frameBorder="0",e.style.width="100%",e.style.height="100%",e.title=t.title,n.appendChild(e)}),console.log("加载游戏评价数据:"+t.info),fetch(t.info).then(e=>e.json()).then(e=>{e.reviews&&e.reviews.length>0?initReviews(e.reviews):document.querySelector(".game-reviews").innerHTML='<p class="no-reviews">No reviews yet</p>'}).catch(e=>{console.error("Failed to load reviews:",e),document.querySelector(".game-reviews").innerHTML='<p class="no-reviews">Failed to load reviews</p>'});const r=document.getElementById("related-games-container");if(r&&gamesData.gameList){r.innerHTML="";const t=gamesData.gameList.filter(t=>t.folder!==e).slice(0,5);t.length>0?t.forEach(e=>{const t=createGameCard(e);r.appendChild(t)}):r.innerHTML='<p class="no-games">No related games</p>'}}"undefined"!=typeof gamesData&&gamesData.gameList?initDetailPage():window.addEventListener("gamesDataLoaded",initDetailPage);