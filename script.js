let gamesData={};async function loadGamesData(){try{console.log("开始加载游戏数据...");const e=await fetch("games/games.json");if(!e.ok)throw new Error(`HTTP错误! 状态码: ${e.status}`);if(gamesData=await e.json(),console.log("游戏数据加载成功:",gamesData),!gamesData.homeGame||!gamesData.gameList)throw new Error("游戏数据格式不正确，缺少必要字段");const t=new Event("gamesDataLoaded");window.dispatchEvent(t),initPage()}catch(e){console.error("加载游戏数据失败:",e),showErrorMessage("Failed to load game list, please try again later")}}function showErrorMessage(e){console.error("显示错误信息:",e);const t=document.createElement("div");t.className="error-message",t.innerHTML=`\n        <p>${e}</p>\n        <button onclick="location.reload()">Reload</button>\n    `,(document.getElementById("other-games-container")||document.body).appendChild(t)}function initPage(){console.log("初始化页面...");const e=window.location.pathname.split("/").pop();console.log("当前路径:",e),"index.html"===e||""===e?initHomePage():"list.html"===e?initListPage():"detail.html"===e&&initDetailPage()}function initHomePage(){console.log("初始化首页...");const e=document.getElementById("featured-game-container");e&&e.addEventListener("click",function(){if(gamesData.homeGame){console.log("加载推荐游戏:",gamesData.homeGame.title),e.innerHTML="";const t=document.createElement("iframe");t.src=gamesData.homeGame.index,t.frameBorder="0",t.style.width="100%",t.style.height="100%",t.title=gamesData.homeGame.title,e.appendChild(t)}else console.warn("没有找到推荐游戏数据")});const t=document.getElementById("other-games-container");if(t){if(console.log("准备加载其他游戏..."),t.innerHTML="",!gamesData.gameList||0===gamesData.gameList.length)return console.warn("游戏列表为空"),void(t.innerHTML='<p class="no-games">No other games available</p>');const e=gamesData.homeGame?gamesData.gameList.filter(e=>e.folder!==gamesData.homeGame.folder):[...gamesData.gameList];console.log(`找到${e.length}个其他游戏`,e),0===e.length?t.innerHTML='<p class="no-games">No other games available</p>':e.forEach((e,a)=>{console.log(`添加游戏 ${a+1}: ${e.title}`);const n=createGameCard(e);t.appendChild(n)})}}function initListPage(){console.log("初始化列表页...");const e=document.getElementById("all-games-container");if(e){if(e.innerHTML="",!gamesData.gameList||0===gamesData.gameList.length)return console.warn("游戏列表为空"),void(e.innerHTML='<p class="no-games">No games available</p>');console.log(`加载全部 ${gamesData.gameList.length} 个游戏`),gamesData.gameList.forEach((t,a)=>{console.log(`添加游戏 ${a+1}: ${t.title}`);const n=createGameCard(t);e.appendChild(n)})}}function initDetailPage(){console.log("初始化详情页...");const e=new URLSearchParams(window.location.search).get("id");if(console.log("游戏ID:",e),!e)return console.warn("没有提供游戏ID，跳转到列表页"),void(window.location.href="list.html");const t=gamesData.gameList.find(t=>t.folder===e);if(!t)return console.warn(`未找到ID为${e}的游戏，跳转到列表页`),void(window.location.href="list.html");console.log("加载游戏详情:",t.title),document.getElementById("game-title").textContent=t.title,document.getElementById("game-author").textContent=t.author||"Unknown",document.getElementById("game-rating").textContent=t.rating||"0",document.getElementById("game-popularity").textContent=t.popularity||"0",document.getElementById("game-description").textContent=t.description||"No description available.";const a=document.getElementById("game-container");if(a){a.innerHTML="";const e=document.createElement("iframe");e.src=t.index,e.frameBorder="0",e.style.width="100%",e.style.height="100%",e.title=t.title,a.appendChild(e)}const n=document.getElementById("related-games-container");if(n&&gamesData.gameList){n.innerHTML="";const t=gamesData.gameList.filter(t=>t.folder!==e).slice(0,5);t.length>0?t.forEach(e=>{const t=createGameCard(e);n.appendChild(t)}):n.innerHTML='<p class="no-games">No related games</p>'}}function createGameCard(e){console.log(`创建游戏卡片: ${e.title}`);const t=document.createElement("div");t.className="game-card",t.onclick=(()=>{console.log(`点击游戏: ${e.title}`),window.location.href=`detail.html?id=${e.folder}`});const a=document.createElement("img");a.src=e.icon,a.alt=e.title,a.onerror=(()=>{console.warn(`无法加载游戏图标: ${e.icon}`),a.src="images/default-game-icon.png"});const n=document.createElement("h3");n.textContent=e.title;const o=document.createElement("p");o.className="game-author",o.textContent=`Author: ${e.author||"Unknown"}`;const l=document.createElement("div");l.className="game-rating";const i=Math.round(e.rating||0);for(let e=1;e<=5;e++){const t=document.createElement("i");t.className=`fas fa-star ${e<=i?"filled":"empty"}`,l.appendChild(t)}const s=document.createElement("p");return s.className="game-popularity",s.textContent=`Popularity: ${e.popularity||0}`,t.appendChild(a),t.appendChild(n),t.appendChild(o),t.appendChild(l),t.appendChild(s),t}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM内容已加载"),loadGamesData()}),window.addEventListener("error",e=>{console.error("全局错误:",e.error),showErrorMessage("An unexpected error occurred, please refresh the page")}),"undefined"!=typeof module&&module.exports&&(module.exports={loadGamesData:loadGamesData,createGameCard:createGameCard,initPage:initPage});